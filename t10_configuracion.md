## Tarea 10: Explica las modificaciones que has hecho en los distintos ficheros de configuración. Entrega las comprobaciones necesarias de que los dos ámbitos están funcionando.

## Servidor

### Fichero interfaces

* Hemos modificado el fichero interfaces de esta forma, configurando la nueva interfaz (eth3) y las nuevas reglas de iptable.

```sh
# This file describes the network interfaces available on your system
# and how to activate them. For more information, see interfaces(5).

source /etc/network/interfaces.d/*

# The loopback network interface
auto lo
iface lo inet loopback

# The primary network interface
allow-hotplug eth0
iface eth0 inet dhcp
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
auto eth1
iface eth1 inet dhcp
    post-up ip route del default dev $IFACE || true
#VAGRANT-END

#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
auto eth2
iface eth2 inet static
      address 192.168.200.2
      netmask 255.255.255.0
      gateway 192.168.200.1
      network 192.168.2.0
      broadcast 192.168.2.255
      dns-nameservers 8.8.8.8
#VAGRANT-END

#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
auto eth3
iface eth3 inet static
      address 192.168.30.2
      netmask 255.255.255.0
      gateway 192.168.30.1
      network 192.168.3.0
      broadcast 192.168.3.255
      dns-nameservers 8.8.8.8
#VAGRANT-END

#reglas de iptable

up iptables -t nat -A POSTROUTING -o eth1 -s 192.168.200.80/24 -j MASQUERADE
down iptables -t nat -D POSTROUTING -o eth1 -s 192.168.200.80/24 -j MASQUERADE

up iptables -t nat -A POSTROUTING -o eth1 -s 192.168.30.50/24 -j MASQUERADE
down iptables -t nat -D POSTROUTING -o eth1 -s 192.168.30.50/24 -j MASQUERADE

```

### Fichero isc-dhcp-server

* Modificamos este fichero para decir por qué interfaz vamos a servir direcciones ip, en este caso por eth2 y eth3. Se indican separadas por espacios.

```sh
nano /etc/default/isc-dhcp-server 
```

```sh
# On what interfaces should the DHCP server (dhcpd) serve DHCP requests?
#       Separate multiple interfaces with spaces, e.g. "eth0 eth1".
INTERFACESv4="eth2 eth3"
#INTERFACESv6=""

```

### Fichero dhcpd.conf 

```sh
nano /etc/dhcp/dhcpd.conf 
```

```sh
# A slightly different configuration for an internal subnet.
subnet 192.168.200.0 netmask 255.255.255.0 {
  range 192.168.200.80 192.168.200.90;
  option domain-name-servers 192.168.200.2;
  option domain-name "s01.local";
  option routers 192.168.200.1;
  option broadcast-address 192.168.200.255;
  default-lease-time 43200;
  max-lease-time 43200;
}

# segunda red                                               
subnet 192.168.30.0 netmask 255.255.255.0 {
  range 192.168.30.50 192.168.30.70;
  option domain-name-servers 192.168.30.2;
  option domain-name "s02.local";
  option routers 192.168.30.1;
  option broadcast-address 192.168.30.255;
  default-lease-time 600;
  max-lease-time 43200;
}

```

#### IP R. Ruta por defecto

* Nos aseguramos que la ruta por defecto esté apuntando bien

```sh
root@servidor:/home/vagrant# ip route change default via 192.168.100.1 dev eth1

root@servidor:/home/vagrant# ip r
default via 192.168.100.1 dev eth1 
10.0.2.0/24 dev eth0 proto kernel scope link src 10.0.2.15 
192.168.30.0/24 dev eth3 proto kernel scope link src 192.168.30.2 
192.168.100.0/24 dev eth1 proto kernel scope link src 192.168.100.156 
192.168.200.0/24 dev eth2 proto kernel scope link src 192.168.200.2 

```

* Reiniciamos el servicio

```sh
root@servidor:/home/vagrant# /etc/init.d/isc-dhcp-server restart
[ ok ] Restarting isc-dhcp-server (via systemctl): isc-dhcp-server.service.

```

## Cliente (nodolan2)


### Fichero interfaces

* Configuramos eth1 por dhcp

```sh
# The primary network interface
allow-hotplug eth0
iface eth0 inet dhcp
#VAGRANT-BEGIN
# The contents below are automatically generated by Vagrant. Do not modify.
auto eth1
iface eth1 inet dhcp  
#VAGRANT-END

```

* Vemos como ha tomado el direccionamiento correcto **192.168.30.50**

![nodlan2ipa.png](https://github.com/CeliaGMqrz/servidor_DHCPv4/blob/main/capturas/nodolan2ipa.png)

### Fichero **resolv.conf**

* Añadimos el nameserver de google para la resolucion de nombres

```sh
domain s02.local
search s02.local
nameserver 192.168.30.2
nameserver 8.8.8.8
```

## Tarea 11: Realiza las modificaciones necesarias para que los cliente de la segunda red local tengan acceso a internet. Entrega las comprobaciones necesarias.


* Primero cambiamos la ruta por defecto (puerta de enlace), apuntamos a nuestro servidor

```sh
root@nodolan2:/home/vagrant# ip route change default via 192.168.30.2 dev eth1
```



## Comprobar conexiones
### IP A y PING al exterior de cada nodo

* Servidor DCHP

![conexion_pns.png](https://github.com/CeliaGMqrz/servidor_DHCPv4/blob/main/capturas/conexion_pns.png)

* Nodolan1

![conexion_pn1.png](https://github.com/CeliaGMqrz/servidor_DHCPv4/blob/main/capturas/conexion_pn1.png)

* Nodolan2

![nodolan2ping.png](https://github.com/CeliaGMqrz/servidor_DHCPv4/blob/main/capturas/nodolan2ping.png)


